// ==UserScript==
// @name         SBG Enhanced UI
// @namespace    https://3d.sytes.net/
// @version      1.6.0
// @downloadURL  https://github.com/egorantonov/sbg-enhanced/releases/latest/download/index.js
// @updateURL    https://github.com/egorantonov/sbg-enhanced/releases/latest/download/index.js
// @description  Enhanced UI for SBG
// @author       https://github.com/egorantonov
// @website      https://github.com/egorantonov/sbg-enhanced/releases
// @match        https://3d.sytes.net
// @match        https://3d.sytes.net/*
// @iconUrl      https://raw.githubusercontent.com/egorantonov/sbg-enhanced/master/assets/script/64.png
// @icon64Url    https://raw.githubusercontent.com/egorantonov/sbg-enhanced/master/assets/script/64.png
// @grant        none
// ==/UserScript==
!function(){"use strict";const e="settings",n="eui-incompatibility",t="1.5.4",o="eui-links-opacity",r="eui-high-contrast",a="eui-animations",i="eui-sort",s="eui-ingress-theme",d="click",l="change",c="load",p="auto",u="hidden",m="disabled",b="loading",h="loaded",g="reference-search",f="discover-progress",x="settings-section__item",y="input",v="span",w="div",$="label",_="style",E="checkbox",k="-proposed",S=document.querySelector(".info.popup"),C=document.getElementById("discover"),I=document.querySelector(".profile.popup"),L=I?.querySelector(".pr-stats"),T=document.getElementById("ops"),A=document.getElementById("inventory__close"),N=document.querySelector(".inventory__content"),O=Array.from(document.querySelectorAll(".settings-section")),D=e=>new Promise((n=>setTimeout(n,e))),B=JSON.parse(localStorage.getItem(e))?.lang??"en",q={incompatibility:{en:"Enhanced UI may be incompatible with current version of SBG",ru:"Enhanced UI может быть несовместим с текущей версией игры"},enhancedUIVersion:{en:"Enhanced UI Version",ru:"Версия Enhanced UI"},ingressStyle:{en:"Ingress Style",ru:"Стиль Ингресс"},highContrast:{en:"High Contrast",ru:"Высокий контраст"},linesOpacity:{en:"Lines opacity",ru:"Прозрачность линий"},linesOpacityMessage:{en:"Enable lines layer to edit opacity",ru:"Включите слой линий для редактирования прозрачности"},animations:{en:"Animations",ru:"Анимации"},searchRefPlaceholder:{en:"Search refs",ru:"Поиск рефов"},kilo:{en:"k",ru:"к"}},P=e=>q[e][B]??q[e].en,F=async()=>{console.log(`SBG Enhanced UI, version ${t}`);const e=await fetch("/api/",{method:"OPTIONS"}).then((e=>e.headers.get("sbg-version")));if("0.2.9"!=e){"true"!=localStorage.getItem(n)&&(alert(`⚠️ ${P("incompatibility")} (${e})`),localStorage.setItem(n,!0))}else localStorage.setItem(n,!1);const o=O.at(-1);if(o){const e=document.createElement(v);e.innerText=P("enhancedUIVersion");const n=document.createElement(v);n.innerText=`v${t}`;const r=document.createElement(w);r.classList.add(x),r.appendChild(e),r.appendChild(n),o.appendChild(r)}},M=async()=>{const e=e=>{e.innerText=" ✕ ",e.dataset.round=!0};Array.from(document.body.querySelectorAll("button.popup-close, button#inventory__close")).forEach((n=>{"[x]"===n.innerText.toLowerCase()&&e(n)}));const n=document.getElementById("settings-credits");n?.addEventListener(d,(async()=>{let n=document.querySelector(".credits.popup .popup-close");for(;!n;)await D(250),n=document.querySelector(".credits.popup .popup-close");1!=n?.dataset?.round&&e(n)}),{once:!0}),T?.addEventListener(d,(async()=>{"X"===A.innerText&&await D(1e3),"[x]"===A.innerText.toLowerCase()&&(A.dataset.round=!0),A.innerText=" ✕ "}),{once:!0})},U="F9FAFC",R="112025",G="FF7C2B",H="49230E",V="20474C",z="007B85",Y="38E8E6",J="FCD959",K="563F20",W="A07F14",X="DAC546",j="112325",Q="CB3C36",Z=`\n@import url('https://fonts.googleapis.com/css2?family=Coda&display=swap');\n\n/* BADGES */\n\nimg.${s} {\n    display: inline;\n}\n\n\n/* BUTTONS */\n\n.game-menu>button, .bottomleft-container>button, body>#layers {\n    font-family: 'Coda', 'Manrope', sans-serif;\n}\n\n.i-buttons>button,\n.settings.popup button:not(.popup-close),\n.attack-slider-buttons>button,\n.draw-slider-buttons>button,\n.inventory.popup button,\n.layers-config__buttons>button,\n.pr-buttons>button,\n#classic-login,\n#form__buttons-login,\n.sbgcui_compare_stats>button,\ninput:not(.sbgcui_settings-amount_input), \nselect {\n    border-style: solid;\n    text-transform: uppercase;\n    font-family: 'Coda', 'Manrope', sans-serif;\n}\n\n#discover, #deploy, #repair, #draw {\n    position: relative;\n}\n\n#${i}:${m} {\n    opacity: 0.7;\n}\n\n.i-buttons>button::before,\n.attack-slider-buttons>button::before,\n.draw-slider-buttons>button::before {\n    content: '';\n    position: absolute;\n    z-index: 1;\n    bottom: -1px;\n    right: -1px;\n    height: 4px;\n    width: 12px;\n    border-radius: 100px 0 0 0;\n    border-left: 2px solid;\n    border-top: 2px solid;\n}\n\n.i-buttons>button,\n.settings.popup button:not(.popup-close),\n#draw-slider-close,\n#attack-slider-close,\n.inventory.popup button,\n.layers-config__buttons>button,\n.pr-buttons>button,\n.sbgcui_compare_stats>button,\ninput:not(.sbgcui_settings-amount_input), select {\n    color: #${"97FBFB"};\n    background: #${V};\n    background: linear-gradient(to top, #${z} 0%, #${V} 30%, #${V} 70%, #${z} 100%);\n    border-color: #${Y};\n}\n\noption {\n    background-color: #${V};\n}\n\noption:checked { /* WTF? checked is non-documented??? */\n    color: #${J};\n    background-color: #${K};\n}\n\n.i-buttons>button::before,\n#draw-slider-close::before,\n#attack-slider-close::before {\n    background-color: #${Y};\n    border-color: #${Y};\n    box-shadow: inset 2px 2px 0 0px #${z};\n}\n\n#attack-slider-fire,\n#draw-slider-confirm,\n#inventory__ma-delete,\n#layers-config__save,\n#classic-login,\n#form__buttons-login {\n    color: #${J};\n    background: linear-gradient(to top, #${W} 0%, #${K} 30%, #${K} 70%, #${W} 100%);\n    border-color: #${X};\n}\n\n.inventory__item-controls::after {\n    border-radius: 0px !important;\n    box-shadow: inset 0px 0px 0px 2px #${X};\n    color: #${J} !important;\n    background: linear-gradient(to top, #${W} 0%, #${K} 30%, #${K} 70%, #${W} 100%) !important;\n}\n\n#attack-slider-fire::before, #draw-slider-confirm::before {\n    background-color: #${X};\n    border-color: #${X};\n    box-shadow: inset 2px 2px 0 0px #${W};\n}\n\n#attack-slider-fire[${m}], #draw-slider-confirm[${m}] {\n    filter: opacity(0.75);\n    -webkit-backdrop-filter: blur(5px);\n    backdrop-filter: blur(5px);\n}\n\n.i-buttons>button[${m}], .draw-slider-buttons>button[${m}] {\n    color: #${"7E888A"};\n    background: #${j};\n    border-color: #${Q};\n}\n\n.i-buttons>button[${m}]::before, .draw-slider-buttons>button[${m}]::before {\n    background-color: #${Q};\n    border-color: #${Q};\n    box-shadow: inset 2px 2px 0 0px #${j};\n}\n\n.popup-close[data-round=true], #inventory__close, .splide__arrow {\n    color: #${J};\n    background: #${K};\n    box-shadow: inset 0px 0px 6px 3px #${W} !important;\n    border-color: #${X} !important;\n}\n\n.splide__arrow svg {\n    fill: #${J};\n}\n\n\n/* SLIDER ITEMS */\n\n.draw-slider-wrp .splide__slide.is-active .refs-list__image>div {\n    box-shadow: inset -8px 0px 0px -5px  #${G},\n        inset -10px 0px 8px -6px  #${H}77,\n        inset 8px 0px 0px -5px  #${G},\n        inset 10px 0px 8px -6px  #${H}77;\n}\n\n\n/* INVENTORY */\n\n.inventory__content, .inventory__tab.active {\n    border-color: var(--selection);\n}\n\n.inventory__controls select,\n.inventory__controls input {\n    border-width: 1.6px;\n}\n\n\n/* POPUPS */\n\n.profile.popup,\n.info.popup,\n.leaderboard.popup,\n.score.popup,\n.settings.popup,\n.layers-config.popup,\n.inventory.popup,\n.credits.popup,\n.inventory__manage-amount,\n#draw-slider,\n#attack-slider,\n.attack-slider-highlevel {\n    color: #${U};\n    background-color: #${R}CC;\n    -webkit-backdrop-filter: blur(5px);\n    backdrop-filter: blur(5px);\n    border-radius: 0px;\n    border-color: #${Y} !important;\n}\n\n.pr-stat:not(:last-child) {\n    border-bottom: 1px #D1D1D144 solid;\n}\n\n.pr-xp-progress {\n    border: none;\n}\n\n.pr-xp-check {\n    background: none;\n}\n\n.layers-config__header,\n.leaderboard.popup>.popup-header,\n.settings.popup>h3,\n.credits.popup h3 {\n    text-transform: uppercase;\n    font-family: 'Coda', 'Manrope', sans-serif;\n}\n\n#discover[data-time]:after {\n    color: #${U};\n}\n\n.${f} {\n    border-radius: 0px !important;\n    background-color: #${Q};\n}\n\n.deploy-slider-error {\n    background-color: #${R}AA;\n}\n\n\n/* SETTINGS */\n\ninput#${o} {\n    background: #${V} !important;\n    border-radius: 0px !important;\n    border: 2px solid #${Y} !important;\n}\n\ninput#${o}::-webkit-slider-thumb {\n    border-radius: 0px;\n    background: #${Y};\n    box-shadow: -250px 0 0 250px #${Y};\n}\n\ninput#${o}::-moz-range-thumb {\n    border-radius: 0px;\n    background: #${Y};\n    box-shadow: -250px 0 0 250px #${Y};\n}\n\n/* CUI */\n.sbgcui_refs-sort-button {\n    border-width: revert;\n    border-radius: 0;\n}\n\n`,ee=`\n\n/* BADGES */\n\nimg.${s} {\n    display: none;\n}\n\n\n/* POPUPS */\n\n.popup {\n    border-radius: 5px;\n}\n\n\n/* BUTTONS */\n\n.game-menu > button, button#ops, .ol-control > button, #attack-menu, body>#layers {\n    text-transform: uppercase;\n}\n\n.popup-close[data-round=true], #inventory__close[data-round=true] {\n    box-shadow: 0 0 5px var(--shadow);\n    font-weight: 600;\n    border: 2px solid #777;\n    border-radius: 100px;\n    height: 2em;\n    width: 2em;\n}\n\n.splide__arrow {\n    height: 3em;\n    width: 3em;\n    border: 1px solid #777;\n    border-radius: 100px;\n    background: buttonface;\n}\n\n.splide__arrow svg {\n    fill: var(--text);\n}\n\n#discover:not([data-time]) .${f},\n.info.popup.hidden .${f} {\n    display: none;\n}\n\n.${f} {\n    position: absolute;\n    top: 0;\n    left: 0;\n    height: 100%;\n    border-radius: 2px;\n    background-color: #7777;\n    filter: opacity(.75);\n    transition: width 1s linear;\n}\n\n\n/* ATTACK SLIDER */\n\n#catalysers-list > .splide__slide {\n    min-width: max-content !important;\n    width: 100px !important;\n}\n\n\n/* DEPLOY SLIDER */\n\n#cores-list > .splide__slide {\n    min-width: max-content !important;\n    width: 80px !important;\n}\n\n\n/* DRAW LINE SLIDER */\n\n.refs-list__image>div {\n    border-radius: 5px;\n}\n\n.draw-slider-wrp .splide__slide {\n    width: calc(((75% + 1em) / 2) - 1em) !important;\n    max-width: 200px;\n    transition: all 0.2s ease-in-out;\n}\n\n.draw-slider-wrp .splide__slide.is-active {\n    transition: all 0.2s ease-in-out;\n}\n\n.draw-slider-wrp .draw-slider-buttons {\n    justify-content: center;\n}\n\n.draw-slider-wrp .draw-slider-buttons button {\n    padding: 6px;\n    text-transform: uppercase;\n}\n\n/* POINT INFO */\n\n#i-image {\n    border-radius: 5px;\n}\n\n.i-buttons {\n    order: 1;\n    margin: 0.5em 0 0.5em;\n    display: flex !important;\n    flex-wrap: nowrap !important;\n    gap: 0.25em !important;\n    width: 100% !important;\n    direction: unset !important;\n}\n\n.i-buttons>button {\n    font-size: 0.9em;\n    padding: 6px 2px;\n    min-width: fit-content;\n    width: calc(25% - 0.25em);\n    flex-basis: unset !important;\n    order: unset !important;\n}\n\n.i-buttons>button[${m}] {\n    filter: opacity(.75);\n}\n\n#discover[data-time]:after {\n    color: var(--text);\n}\n\n.i-stat__cores {\n    margin-top: 0.5em;\n}\n\n.i-stat__core {\n    border-width: 1px;\n    border-radius: 100px;\n    width: 1.7em;\n    height: 1.7em;\n    line-height: 1.7em;\n}\n\n.i-stat__core.selected {\n    border-width: 2px;\n}\n\n.deploy-slider-error {\n    border-radius: 5px;\n}\n\n\n/* SETTINGS */\n\ninput#${o} {\n    -webkit-appearance: none;\n    appearance: none;\n    overflow: hidden;\n    padding: 0;\n    max-width: 100px;\n    background: #7777;\n    border-radius: 3px;\n    border: none !important;\n}\n\ninput#${o}::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    border: 0px solid transparent;\n    height: 16px;\n    width: 16px;\n    border-radius: 3px;\n    background: var(--selection);\n    box-shadow: -250px 0 0 250px var(--selection);\n    cursor: pointer;\n}\n\ninput#${o}::-moz-range-thumb {\n\n    border: 0px solid transparent;\n    height: 16px;\n    width: 16px;\n    border-radius: 3px;\n    background: #${Y};\n    box-shadow: -250px 0 0 250px #${Y};\n    cursor: pointer;\n}\n\n/* INVENTORY */\n\n#inventory-delete-section {\n    margin-right: 0;\n}\n\n.inventory__controls select,\n.inventory__controls input {\n    min-width: 50px;\n    width: 100%;\n}\n\ninput[data-type="${g}"] {\n    padding: 0 6px;\n}\n\n/* SBG CUI Enhancements and support */\n\n.sbgcui_xpProgressBar {\n    background-color: var(--background-transp);\n    border-radius: 5px;\n}\n\n#attack-menu, .topleft-container {\n    backdrop-filter: none !important;\n    -webkit-backdrop-filter: none;\n}\n\n.sbgcui_no_loot, .sbgcui_no_refs {\n    display: none !important;\n}\n\n.fa-classic, .fa-regular, .fa-solid, .far, .fas {\n    font-family: "Font Awesome 6 Free" !important;\n}\n\n.sbgcui_refs-sort-button {\n    position: static;\n    height: revert;\n    width: revert;\n    color: revert;\n    background-color: revert;\n    border: 1px solid #777;\n    border-radius: 2px;\n    box-shadow: revert;\n    min-width: 30px;\n    font-size: 1em;\n}\n\n`,ne=new RegExp(String.raw`(\d*\.?\d+?)\s(${P("kilo")}?)`,"i"),te=e=>{const[n,t,o]=e.querySelector(".inventory__item-descr").lastChild.textContent.replace(",","").match(ne);return o===P("kilo")?1e3*t:+t},oe=`\n\n/* ANIMATIONS */\nhtml, body {\n    overflow: hidden;\n}\n\n.info.popup, .profile.popup {\n    transition: all ease-in-out 0.25s;\n}\n\n.info.popup.${u}, .profile.popup.${u} {\n    display: flex !important;\n    filter: opacity(0);\n    transform: translateX(calc(100% + 10px));\n}\n\n@media (max-width: 425px) {\n    .info.popup.${u}, .profile.popup.${u} {\n        transform: translate(calc(100% + 10px), -50%);\n    }\n}\n\n.inventory.popup {\n    transition: all ease-in-out 0.25s;\n}\n\n.inventory.popup.${u} {\n    display: flex !important;\n    filter: opacity(0);\n    transform: translate(calc(-150% - 10px), -50%);\n}\n\n.leaderboard.popup, .settings.popup {\n    transition: all ease-in-out 0.25s;\n}\n\n.leaderboard.popup.${u}, .settings.popup.${u} {\n    display: flex !important;\n    filter: opacity(0);\n    transform: translate(-50%, calc(-50vh - 100%));\n}\n\n.attack-slider-wrp {\n    transition: all ease-in-out 0.25s;\n}\n\n.attack-slider-wrp.${u} {\n    display: flex !important;\n    filter: opacity(0);\n    transform: translateY(calc(25vh + 100%));\n}\n\n.layers-config.popup, .score.popup {\n    visibility: visible;\n    transition: visibility 0s, filter ease-in-out 0.25s;\n}\n\n.layers-config.popup.${u}, .score.popup.${u} {\n    display: block !important;\n    filter: opacity(0);\n    visibility: hidden;\n}\n`,re=async()=>{const e=()=>document.querySelector(".ol-layer__lines"),n="0.75";let t=document.createElement(w);t.className=x;let r=document.createElement(v);r.innerText=P("linesOpacity"),t.appendChild(r);let a=document.createElement(y);a.id=o,a.setAttribute("type","range"),a.setAttribute("min","0"),a.setAttribute("max","1"),a.setAttribute("step","0.01"),t.appendChild(a);const i=O.at(1);i?.appendChild(t);const s=localStorage.getItem(o);a.setAttribute("value",s??n);let d=e();d||(await D(2e3),d=e()),a.addEventListener(l,(n=>{d||(d=e()),d?(d.style.filter=`opacity(${n.target.value})`,localStorage.setItem(o,n.target.value)):alert(P("linesOpacityMessage"))})),d&&(d.style.filter=`opacity(${s??n})`)},ae=new Map,ie=(e,n)=>{let t=[];for(let o=e.length;o>0;o--)t.push({tier:e[e.length-o],value:`https://raw.githubusercontent.com/egorantonov/sbg-enhanced/master/assets/64/${n}${o}.png`});return t};ae.set("Points Captured",{images:ie([4e4,15e3,5e3,1e3,100],"liberator")}),ae.set("Lines Drawn",{images:ie([1e5,25e3,5e3,1e3,50],"connector")}),ae.set("Unique Points Visited",{images:ie([3e4,1e4,2e3,1e3,100],"explorer")}),ae.set("Discoveries Done",{images:ie([2e5,1e5,3e4,1e4,2e3],"hacker")}),ae.set("Points Captured",{images:ie([2e4,5e3,1e3,200,20],"pioneer")}),ae.set("Cores Destroyed",{images:ie([225e3,75e3,22500,7500,1500],"purifier")}),ae.set("Cores Deployed",{images:ie([15e4,75e3,22500,7500,1500],"builder")}),ae.set("Longest Point Ownership",{images:ie([150,90,20,10,3],"guardian")});const se="badge-image",de="pointStatsChanged",le={target:document.getElementById("i-stat__line-out"),config:{childList:!0},callback:e=>{const n=new Event(de,{bubbles:!0});e[0].target.dispatchEvent(n)}},ce="discoverChanged",pe={target:C,config:{attributes:!0,attributeFilter:["data-time"]},callback:e=>{const n=new Event(ce,{bubbles:!0});e[0].target.dispatchEvent(n)}},ue="profileStatsChanged",me={target:L,config:{childList:!0},callback:e=>{if(e.find((e=>e.addedNodes.length&&e.addedNodes[0].classList.contains("pr-stats__section")))){const n=new Event(ue,{bubbles:!0});e[0].target.dispatchEvent(n)}}},be=()=>{I?.addEventListener(ue,(()=>{(()=>{const e=document.querySelectorAll(`.${se}`);for(let n=0;n<e.length;n++)e[n].remove();const n=Array.from(document.querySelectorAll(".pr-stat"));for(let e=0;e<n.length;e++){const t=n[e],o=t.firstChild.innerText;if(ae.has(o)){const e=+t.lastChild.innerText.replace(/,| days| km|/g,""),n=ae.get(o).images.find((n=>n.tier<=e));if(!n)continue;const r=document.createElement("img");r.className=se,r.src=n.value,r.title=e,r.width=40,r.height=40,r.classList.add(s),L?.prepend(r)}}})()}))},he=()=>[le,me,pe].forEach((e=>(({target:e,config:n,callback:t})=>e&&n&&t&&new MutationObserver(t).observe(e,n))(e)));window.addEventListener(c,(function(){D(1500).then((()=>{(()=>{const e=document.createElement(_);e.dataset.id="eui-common-styles",document.head.appendChild(e),e.innerHTML=ee})(),(()=>{const e=document.createElement(y),n=O.at(1);if(n){const t=document.createElement(v);t.innerText=P("highContrast"),e.type=E,e.dataset.setting=r;const o=document.createElement($);o.classList.add(x),o.appendChild(t),o.appendChild(e),n.appendChild(o)}const t=document.createElement(_);t.dataset.id=r,t.innerHTML='\n\n/* DARK THEME */\n@media (prefers-color-scheme: dark) {\n    :root[data-theme="auto"] .popup,\n    :root[data-theme="auto"] #draw-slider,\n    :root[data-theme="auto"] #attack-slider,\n    :root[data-theme="auto"] .attack-slider-highlevel {\n        color: #fff;\n        background: #000;\n    }\n}\n\n:root[data-theme="dark"] .popup,\n:root[data-theme="dark"] #draw-slider,\n:root[data-theme="dark"] #attack-slider,\n:root[data-theme="dark"] .attack-slider-highlevel {\n    color: #fff;\n    background: #000;\n}\n\n/* LIGHT THEME */\n@media (prefers-color-scheme: light) {\n    :root[data-theme="auto"] .popup,\n    :root[data-theme="auto"] #draw-slider,\n    :root[data-theme="auto"] #attack-slider,\n    :root[data-theme="auto"] .attack-slider-highlevel {\n        color: #000;\n        background: #fff;\n    }\n}\n\n:root[data-theme="light"] .popup,\n:root[data-theme="light"] #draw-slider,\n:root[data-theme="light"] #attack-slider,\n:root[data-theme="light"] .attack-slider-highlevel {\n    color: #000;\n    background: #fff;\n}\n\n',1==localStorage.getItem(r)&&(document.head.appendChild(t),e.checked=!0),e.addEventListener(l,(e=>{e.target.checked?(document.head.appendChild(t),localStorage.setItem(r,1)):(t.remove(),localStorage.setItem(r,0))}))})(),(()=>{const e=document.createElement(y),n=O.at(1);if(n){const t=document.createElement(v);t.innerText=P("animations"),e.type=E,e.dataset.setting=a;const o=document.createElement($);o.classList.add(x),o.appendChild(t),o.appendChild(e),n.appendChild(o),1!=localStorage.getItem(`${a}${k}`)&&(localStorage.setItem(`${a}${k}`,1),localStorage.setItem(a,1),e.checked=!0)}const t=document.createElement(_);t.dataset.id=a,t.innerHTML=oe,1==localStorage.getItem(a)&&(document.head.appendChild(t),e.checked=!0),e.addEventListener(l,(e=>{e.target.checked?(document.head.appendChild(t),localStorage.setItem(a,1)):(t.remove(),localStorage.setItem(a,0))}))})(),(()=>{const n=document.createElement(y),t=O.at(0);if(t){const e=document.createElement(v);e.innerText=P("ingressStyle"),n.type=E,n.dataset.setting=s;const o=document.createElement($);o.classList.add(x),o.appendChild(e),o.appendChild(n),t.appendChild(o)}if(1!=localStorage.getItem(`${s}${k}`)){localStorage.setItem(`${s}${k}`,1),localStorage.setItem(s,1),n.checked=!0,document.documentElement.dataset.theme=p;let t=JSON.parse(localStorage.getItem(e));t&&(t.theme=p,localStorage.setItem(e,JSON.stringify(t)))}const o=document.createElement(_);o.dataset.id=s,o.innerHTML=Z,1==localStorage.getItem(s)&&(document.head.appendChild(o),n.checked=!0),n.addEventListener(l,(e=>{e.target.checked?(document.head.appendChild(o),localStorage.setItem(s,1)):(o.remove(),localStorage.setItem(s,0))}))})(),he(),(()=>{const e=document.getElementById("draw");S&&e&&S.addEventListener(de,(n=>{n.target.innerText>=20?(e.setAttribute(m,!0),e.classList.add(b)):e.classList.contains(b)&&(e.classList.remove(b),e.removeAttribute(m))}))})(),(()=>{const e=I?.querySelector("button.popup-close");e?.addEventListener(d,(()=>{let e=I.querySelectorAll(`.${se}`);for(let n=0;n<e.length;n++)e[n].remove()}))})(),(()=>{if(S&&C){const e=document.createElement(w);e.className=f,C.appendChild(e),S.addEventListener(ce,(n=>{let t=n.target.dataset?.time;t?t.replace("s","")>0?e.style.width=100*t.replace("s","")/60+"%":t.replace("m","")>0?e.style.width="100%":e.style.width=0:e.style.width=0}))}})(),be(),(()=>{const e=Array.from(document.querySelectorAll(".inventory__tab"));let n=[],t=[];const o=()=>N.dispatchEvent(new Event("scroll")),r=()=>Array.from(N.querySelectorAll("div.inventory__item")),a=e=>{let n=r();n.forEach((e=>e.classList.remove(u))),n.filter((n=>!n.innerText.slice(n.innerText.indexOf(")")+1,n.innerText.indexOf("\n")).trim().toLowerCase().includes(e.toLowerCase()))).forEach((e=>e.classList.add(u))),o()},s=document.createElement(y);s.type="search",s.id="eui-search",s.dataset.type=g,s.placeholder=P("searchRefPlaceholder");const c=document.createElement("select");c.id=i;const p=document.querySelector(".sbgcui_refs-sort-button");p&&(c.style.display="none");const m=["Name","Dist+","Dist-"];m.forEach((e=>{let n=document.createElement("option");n.value=e,n.innerText=e,c.appendChild(n)}));let f=document.getElementById("inventory-delete-section");e.forEach((e=>{e.addEventListener(d,(()=>{["1","2"].includes(e.dataset.type)?(t=[],s.dataset.active="0",s.remove(),c.selectedIndex=0,c.disabled=!1,c.remove()):(t=r(),0===n.length&&(n=r()),f.after(s),s.after(c),p&&s.after(p),s.dataset.active="1",s.value&&a(s.value))}))})),A?.addEventListener(d,(()=>{t=[],n=[],c.selectedIndex=0,c.disabled=!1})),T?.addEventListener(d,(async()=>{if("1"===s.dataset.active){for(t=[];0===t.length;)await D(200),t=r(),n=r();s.value&&a(s.value)}})),s.addEventListener("input",(e=>{a(e.target.value)})),c.addEventListener(l,(async e=>{c.disabled=!0;const i=e.target.value;if(i===m[0])return t.forEach((e=>e.remove())),t=[],n.forEach((e=>N.appendChild(e))),"1"===s.dataset.active&&s.value&&a(s.value),void(c.disabled=!1);if(t=r(),0!==t.filter((e=>!e.classList.contains(h))).length){let e=!1;for(;t.find((e=>!e.classList.contains(h)));)e||(t.forEach((e=>{!e.classList.contains(u)&&e.classList.add(u)})),e=!0),o(),console.log("Yet to load: "+t.filter((e=>!e.classList.contains(h))).length),await D(250);t.forEach((e=>{e.classList.contains(u)&&e.classList.remove(u)}))}let d=t.sort(((e,n)=>te(e)-te(n)));i===m[2]&&d.reverse(),d.forEach((e=>{N.appendChild(e),e.classList.toggle(b),e.classList.toggle(b)})),"1"===s.dataset.active&&s.value&&a(s.value),c.disabled=!1}))})()}))}),!1),window.addEventListener(c,(async function(){await D(1600),await Promise.all([F(),re(),M()])}),!1)}();